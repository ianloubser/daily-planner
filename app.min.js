import{getApps as e}from"firebase/app";import{getFirestore as t,addDoc as o,collection as n,deleteDoc as s,doc as a,updateDoc as d,onSnapshot as r}from"firebase/firestore";import{getAuth as i,GoogleAuthProvider as l,signInWithPopup as c}from"firebase/auth";var u=((e,t,o=!1)=>{var n=e||document,s=t||document;window._state={};var a={};const d={flush:(...e)=>{e.forEach((e=>{const t=a[e];let o=s.createElement(t.type);i(o,t),l(t,o),n.getElementById(e).replaceWith(o)}))}},r=e=>e&&"object"==typeof e&&!Array.isArray(e),i=(e,...t)=>{if(!t.length)return e;const o=t.shift();if(r(e)&&r(o))for(const t in o)"function"!=typeof o[t]||"className"!==t&&"style"!==t?r(o[t])?(e[t]||Object.assign(e,{[t]:{}}),i(e[t],o[t])):Object.assign(e,{[t]:o[t]}):"style"===t?(e[t]||Object.assign(e,{[t]:{}}),i(e[t],o[t]())):Object.assign(e,{[t]:o[t]()});return i(e,...t)},l=(e,t)=>{null!=e&&("function"==typeof e?l(e(),t):Array.isArray(e)?e.forEach((e=>l(e,t))):e.nodeType===Node.ELEMENT_NODE?t.appendChild(e):"object"==typeof e?l(e.child,t):t.innerText=`${e}`)},c=e=>t=>{var n=s.createElement(e);return null!=t&&(r(t)&&(null!=t.id&&(a[t.id]={type:e,...t}),i(n,t)),l(t,n)),o&&(n.style.backgroundColor=`#${Math.floor(16777215*Math.random()).toString(16)}ab`),n},u={get:function(e,t,o){return null!=e[t]?e[t]:c(t)}};return new Proxy(d,u)})();const p=e()[0],h=t(p),m=i(p),y=async e=>{try{await o(n(h,"user",m.currentUser.uid,"tasks"),{done:!1,text:e,created:(new Date).getTime()})}catch(e){console.error("Error adding document: ",e)}},f=async e=>{await s(a(h,"user",m.currentUser.uid,"tasks",e))},w=async e=>{const{id:t,...o}=e,n=a(h,"user",m.currentUser.uid,"tasks",t);await d(n,o)},g=e=>{m.onAuthStateChanged((t=>{t?r(n(h,"user",t.uid,"tasks"),(t=>{const o=t.docs.map((e=>({...e.data(),id:e.id})));o.sort(((e,t)=>t.created-e.created)),e(o)})):e([])}))},v=e()[0],x=new l,b=i(v);x.setCustomParameters({prompt:"select_account"});const k=()=>b.currentUser,E=()=>c(b,x),D=()=>b.signOut(),_=e=>{const t=e;return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},I=e=>e&&e.length?[...e.map(C)]:u.i({style:{color:"gray"},child:"No items to show"}),O=()=>u.div({style:{display:"flex",justifyContent:"space-between"},child:[u.h4("Today"),N]}),S=(e,t=window._state.maxOverdue)=>{const o=parseInt((new Date-new Date(e.created))/864e5)/t,n=Math.min(Math.max(o,0),1);return parseInt(255*n).toString(16)},C=e=>{const t=()=>{f(e.id),u.flush("todos")},o=async()=>{await w({...e,done:!e.done,completed:(new Date).getTime()})},n=()=>{const t=e.done?new Date(e.completed):new Date;return Math.floor((_(t)-_(new Date(e.created)))/864e5)};return()=>u.div({className:"todo-row",style:{backgroundColor:e.done?void 0:`#ff0000${S(e)}`},child:[u.input({type:"checkbox",checked:e.done,onclick:o}),u.span({style:`\n                    font-size: 20px;\n                    margin-left: 50px;\n                    flex: 1;\n                    cursor: pointer;\n                    text-decoration: ${e.done?"line-through":void 0};\n                `,child:e.text,onclick:o}),u.span({style:{color:"black",fontStyle:"italic"},child:n()>0?`${n()}d`:""}),u.button({onclick:t,className:"todo-delete",child:"🗑️"})]})};(e=>{b.onAuthStateChanged(e)})((()=>{u.flush("auth-header")}));const M=async()=>{try{await E()}catch(e){console.log("Error",e),alert(e.message)}},j=()=>u.div({id:"auth-header",child:()=>k()&&!k().isAnonymous?u.div({style:{display:"flex",flexDirection:"column"},child:[u.span(`${k().email}`),u.button({child:"logout",onclick:()=>D()})]}):u.button({child:"login",onclick:M})}),N=()=>{let e=!1;const t=()=>{if(!e)return;e=!1;const t=document.getElementById("overdue-input").value;window._state.maxOverdue=parseInt(t),localStorage.setItem("max_overdue",parseInt(t)),u.flush("todos")};return u.div({style:{display:"flex",alignItems:"center"},child:[u.span("Max days overdue: "),u.input({onkeyup:e=>{"Enter"===e.key&&t()},onblur:t,onfocus:()=>e=!0,style:{marginLeft:5,fontSize:14,width:80,padding:"3px 7px"},value:window._state.maxOverdue,id:"overdue-input"})]})};window._state.todos=[],window._state.maxOverdue=localStorage.getItem("max_overdue")||5,g((e=>{window._state.todos=e,u.flush("todos")})),window.addEventListener("focus",(()=>{u.flush("todos")}));var A=u.div({className:"app",child:[()=>u.div({style:{display:"flex",flex:1,justifyContent:"space-between",alignItems:"center",padding:"10px 0"},child:[u.h2("Day planner"),j]}),()=>{const e=async()=>{const e=document.getElementById("todo-input");y(`${e.value}`),e.value="",u.flush("todos")};return u.div({style:{display:"flex",flex:1},child:[u.input({onkeyup:t=>{"Enter"===t.key&&e()},style:{display:"flex",flex:1,fontSize:22,padding:"10px 15px"},id:"todo-input"}),u.button({onclick:e,child:"Save"})]})},()=>u.div({id:"todos",child:()=>{const e=(()=>{const e=_(new Date),t=[...window._state.todos].filter((t=>t.done&&t.completed>e||!t.done)).sort(((e,t)=>e.done?1:t.done?-1:0)),o=new Date(e.getTime());return o.setDate(e.getDate()-1),[t,[...window._state.todos].filter((t=>t.completed>=o&&t.completed<e&&t.done)),[...window._state.todos].filter((e=>(void 0===e.completed||e.completed<o)&&e.done)).sort(((e,t)=>t.completed-e.completed))]})();return[O,I(e[0]),u.h4("Yesterday"),I(e[1]),u.h4("Older"),I(e[2])]}})]});document.body.appendChild(A);
